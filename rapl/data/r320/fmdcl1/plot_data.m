%plot-data.m
n = 13; % sample averaging window
% average pkg over window n
pkg_new = arrayfun(@(i) mean(pkg_pg(i:i+n-1)),1:n:length(pkg_pg)-n+1)';
t_new = arrayfun(@(i) t_pg(i),1:n:length(pkg_pg)-n+1)';

fh1=figure;
%h_pkg=plot(t_pg,pkg_pg,':r','markersize',10,'linewidth',2);
h_pkg=plot(t_new,pkg_new,'-.m','markersize',10,'linewidth',2);
hold on;
[x_sp,y_sp]=stairs(t_fmd,sp_fmd);
[ax_yy,h_sp,h_freq]=plotyy(x_sp,y_sp,t_fmd,freq_fmd/1000-60.0);
set(h_sp, 'linestyle','--','linewidth',2);
set([h_pkg h_freq],'linewidth',2);
ax_sp=ax_yy(1);
%ylim(ax_sp,[20,35]);
ax_freq=ax_yy(2);
%ylim(ax_fps,[50,150]);
%axes(ax_sp);
xlabel('Time (seconds)');
ylabel(ax_sp,'Power (watts)');
ylabel(ax_freq,'Freq Dev. (Hz)');
grid on;
T1 = title({"Video Transcoding DR with Frequency Deviation and Buffer as Input"});
[hleg, hleg_obj, hplot, labels]=legend([h_pkg h_sp h_freq],{'PKG','Setpoint','Freq Dev.'},'location','northeast');
set(hleg_obj,'linewidth',4);
FS=findall(hleg_obj,'-property','fontsize');
set(FS,'fontsize',18);
FS=findall(ax_sp,'-property','Fontsize');
set(FS, "fontsize", 18, "linewidth", 2);
FS=findall(ax_freq,'-property','Fontsize');
set(FS, "fontsize", 18, "linewidth", 2);
legend boxoff;
hold off;

fh2=figure;
%h_pkg=plot(t_pg,pkg_pg,':r','markersize',10,'linewidth',2);
h_pkg=plot(t_new,pkg_new,'-.m','markersize',10,'linewidth',2);
hold on;
[x_sp,y_sp]=stairs(t_fmd,sp_fmd);
[ax_yy,h_sp,h_frame]=plotyy(x_sp,y_sp,t_fmd,frame_fmd);
set(h_sp, 'linestyle','--','linewidth',2);
set([h_pkg h_frame],'linewidth',2);
ax_sp=ax_yy(1);
%ylim(ax_sp,[20,35]);
ax_frame=ax_yy(2);
%ylim(ax_fps,[50,150]);
%axes(ax_sp);
xlabel('Time (seconds)');
ylabel(ax_sp,'Power (watts)');
ylabel(ax_frame,'Frame Number');
grid on;
T1 = title({"Video Transcoding DR with Frequency Deviation and Buffer as Input"});
[hleg, hleg_obj, hplot, labels]=legend([h_pkg h_sp h_frame],{'PKG','Setpoint','Frame#'},'location','northeast');
set(hleg_obj,'linewidth',4);
FS=findall(hleg_obj,'-property','fontsize');
set(FS,'fontsize',18);
FS=findall(ax_sp,'-property','Fontsize');
set(FS, "fontsize", 18, "linewidth", 2);
FS=findall(ax_frame,'-property','Fontsize');
set(FS, "fontsize", 18, "linewidth", 2);
legend boxoff;
hold off;
